---
description: åŠ¨æ€å†…å®¹æ–‡æœ¬å¤„ç†è§„èŒƒï¼Œè§£å†³æ–‡æœ¬è¶…é•¿ã€æº¢å‡ºã€æˆªæ–­ç­‰é—®é¢˜
globs:
  - "client/**/*.ts"
  - "client/**/*.tsx"
  - "client/**/*.less"
  - "client/**/*.scss"
alwaysApply: true
tags:
  - "text"
  - "ui"
  - "responsive"
  - "user-experience"
priority: 85
language: "typescript"
framework: "taro"
---

# æ–‡æœ¬å¤„ç†ä¸æ˜¾ç¤ºè§„èŒƒ

> ç¡®ä¿åŠ¨æ€å†…å®¹åœ¨ä¸åŒå¹³å°å’Œè®¾å¤‡ä¸Šçš„æœ€ä½³æ˜¾ç¤ºæ•ˆæœ

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

### è®¾è®¡ç†å¿µ
- **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼šç¡®ä¿æ–‡æœ¬åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šæ¸…æ™°å¯è¯»
- **å¹³å°é€‚é…**ï¼šé’ˆå¯¹H5å’Œå°ç¨‹åºæä¾›ä¸åŒçš„æ˜¾ç¤ºç­–ç•¥
- **æ€§èƒ½è€ƒè™‘**ï¼šé¿å…æ–‡æœ¬æ¸²æŸ“å¯¼è‡´çš„å¸ƒå±€æŠ–åŠ¨
- **å†…å®¹å®Œæ•´æ€§**ï¼šåœ¨æˆªæ–­çš„åŒæ—¶ä¿æŒä¿¡æ¯çš„å®Œæ•´æ€§

### å¤„ç†ä¼˜å…ˆçº§
1. **é˜²æ­¢å¸ƒå±€ç ´å**ï¼šæ–‡æœ¬è¶…é•¿ä¸èƒ½å½±å“æ•´ä½“å¸ƒå±€
2. **ä¿æŒä¿¡æ¯å¯è¯»**ï¼šæˆªæ–­åçš„æ–‡æœ¬ä»éœ€ä¼ è¾¾æ ¸å¿ƒä¿¡æ¯
3. **å¹³å°ä¸€è‡´æ€§**ï¼šç›¸åŒå†…å®¹åœ¨ä¸åŒå¹³å°çš„æ˜¾ç¤ºé€»è¾‘ä¸€è‡´
4. **äº¤äº’å‹å¥½**ï¼šæä¾›æŸ¥çœ‹å®Œæ•´å†…å®¹çš„æ–¹å¼

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ–‡æœ¬å¤„ç†å·¥å…·å‡½æ•°
```typescript
// src/utils/textUtils.ts

/**
 * æ™ºèƒ½æ–‡æœ¬æˆªæ–­ï¼ˆè€ƒè™‘ä¸­è‹±æ–‡å­—ç¬¦å®½åº¦ï¼‰
 * @param text åŸå§‹æ–‡æœ¬
 * @param maxWidth æœ€å¤§æ˜¾ç¤ºå®½åº¦
 * @param ellipsis çœç•¥å·
 */
export function truncateTextByWidth(
  text: string, 
  maxWidth: number, 
  ellipsis: string = '...'
): string {
  // ä¸­æ–‡å­—ç¬¦æŒ‰2ä¸ªå­—ç¬¦å®½åº¦è®¡ç®—
  // è‹±æ–‡æ•°å­—æŒ‰1ä¸ªå­—ç¬¦å®½åº¦è®¡ç®—
}

/**
 * å¹³å°è‡ªé€‚åº”æ–‡æœ¬å¤„ç†
 */
export function formatUsername(name: string, maxLength?: number): string
export function formatTitle(title: string, maxLength?: number): string
export function formatDescription(desc: string, maxLength?: number): string
export function formatNumber(num: number): string // 1k, 1w æ ¼å¼åŒ–
```

### å¹³å°å·®å¼‚åŒ–é…ç½®
```typescript
// æ–‡æœ¬é•¿åº¦é™åˆ¶é…ç½®
export const TEXT_CONFIG = {
  // å°ç¨‹åºç¯å¢ƒ
  USERNAME_MAX_LENGTH: 6,      // ç”¨æˆ·åï¼š6ä¸ªå­—ç¬¦å®½åº¦
  TITLE_MAX_LENGTH: 20,        // æ ‡é¢˜ï¼š20ä¸ªå­—ç¬¦å®½åº¦
  DESCRIPTION_MAX_LENGTH: 60,  // æè¿°ï¼š60ä¸ªå­—ç¬¦å®½åº¦
  
  // H5ç¯å¢ƒï¼ˆæ›´ç´§å‡‘ï¼‰
  H5_USERNAME_MAX_LENGTH: 4,   // ç”¨æˆ·åï¼š4ä¸ªå­—ç¬¦å®½åº¦
  H5_TITLE_MAX_LENGTH: 16,     // æ ‡é¢˜ï¼š16ä¸ªå­—ç¬¦å®½åº¦
  H5_DESCRIPTION_MAX_LENGTH: 45 // æè¿°ï¼š45ä¸ªå­—ç¬¦å®½åº¦
} as const
```

## ğŸ¨ CSSæ ·å¼è§„èŒƒ

### åŸºç¡€æ–‡æœ¬æº¢å‡ºæ ·å¼
```less
// å•è¡Œæ–‡æœ¬çœç•¥
.text-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 100%;
}

// å¤šè¡Œæ–‡æœ¬çœç•¥
.text-multiline-ellipsis(@lines: 2) {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: @lines;
  overflow: hidden;
  word-break: break-word;
  hyphens: auto;
  line-height: 1.4;
}

// ä¸­è‹±æ–‡æ··æ’ä¼˜åŒ–
.text-mixed-content {
  word-break: break-word;
  word-wrap: break-word;
  hyphens: auto;
  text-rendering: optimizeLegibility;
}
```

### ç»„ä»¶çº§åˆ«çš„æ–‡æœ¬å¤„ç†
```less
// ç”¨æˆ·åæ˜¾ç¤º
.username {
  .text-ellipsis();
  max-width: 120px; // å°ç¨‹åº
  font-weight: 500;
  
  .platform-h5 & {
    max-width: 80px !important; // H5æ›´ç´§å‡‘
    font-size: 13px !important;
  }
}

// å¡ç‰‡æ ‡é¢˜
.card-title {
  .text-multiline-ellipsis(2);
  font-size: 32px;
  line-height: 1.4;
  margin-bottom: 12px;
  
  .platform-h5 & {
    font-size: 16px !important;
    margin-bottom: 6px !important;
  }
}

// å¡ç‰‡æè¿°
.card-description {
  .text-multiline-ellipsis(3);
  font-size: 28px;
  line-height: 1.5;
  color: @text-color-light;
  
  .platform-h5 & {
    font-size: 14px !important;
  }
}
```

## ğŸ“± ç»„ä»¶ä½¿ç”¨è§„èŒƒ

### Reactç»„ä»¶ä¸­çš„æ–‡æœ¬å¤„ç†
```tsx
import { formatUsername, formatTitle, formatDescription, formatNumber } from '@/utils/textUtils'
import PlatformUtils from '@/utils/platform'

const UserCard: FC<Props> = ({ user, content }) => {
  const isH5 = PlatformUtils.isH5()
  
  // æ ¹æ®å¹³å°åŠ¨æ€è°ƒæ•´æ–‡æœ¬é•¿åº¦
  const displayName = formatUsername(
    user.name, 
    isH5 ? TEXT_CONFIG.H5_USERNAME_MAX_LENGTH : TEXT_CONFIG.USERNAME_MAX_LENGTH
  )
  
  const displayTitle = formatTitle(
    content.title,
    isH5 ? TEXT_CONFIG.H5_TITLE_MAX_LENGTH : TEXT_CONFIG.TITLE_MAX_LENGTH
  )
  
  return (
    <View className="user-card">
      <Text className="username">{displayName}</Text>
      <Text className="card-title">{displayTitle}</Text>
      <Text className="card-description">
        {formatDescription(content.description)}
      </Text>
      <Text className="stat-count">
        {formatNumber(content.likes)} èµ
      </Text>
    </View>
  )
}
```

### åŠ¨æ€å†…å®¹å¤„ç†ç­–ç•¥
```tsx
// é•¿æ–‡æœ¬å†…å®¹çš„å¤„ç†
const LongContentCard: FC<Props> = ({ content }) => {
  const [expanded, setExpanded] = useState(false)
  const isH5 = PlatformUtils.isH5()
  
  const maxLength = isH5 ? 45 : 60
  const needsTruncation = getTextWidth(content) > maxLength
  
  const displayContent = expanded 
    ? content 
    : formatDescription(content, maxLength)
  
  return (
    <View>
      <Text className="content">{displayContent}</Text>
      {needsTruncation && (
        <Text 
          className="expand-btn" 
          onClick={() => setExpanded(!expanded)}
        >
          {expanded ? 'æ”¶èµ·' : 'å±•å¼€'}
        </Text>
      )}
    </View>
  )
}
```

## ğŸ“Š æ•°å­—æ ¼å¼åŒ–è§„èŒƒ

### æ•°å­—æ˜¾ç¤ºä¼˜åŒ–
```typescript
/**
 * æ•°å­—æ ¼å¼åŒ–è§„åˆ™ï¼š
 * < 1,000: æ˜¾ç¤ºåŸæ•°å­— (999)
 * < 10,000: æ˜¾ç¤ºå°æ•°ç‚¹ (9.9k)
 * < 100,000: æ˜¾ç¤ºæ•´æ•°k (99k)
 * >= 100,000: æ˜¾ç¤ºw (10w)
 */
export function formatNumber(num: number): string {
  if (num < 1000) return num.toString()
  if (num < 10000) return (num / 1000).toFixed(1) + 'k'
  if (num < 100000) return Math.floor(num / 1000) + 'k'
  return Math.floor(num / 10000) + 'w'
}

// ä½¿ç”¨ç¤ºä¾‹
const likes = 1234 // æ˜¾ç¤ºä¸º "1.2k"
const views = 15678 // æ˜¾ç¤ºä¸º "16k"
const followers = 123456 // æ˜¾ç¤ºä¸º "12w"
```

## ğŸ”§ å¼€å‘æœ€ä½³å®è·µ

### æ–‡æœ¬å¤„ç†æ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬éƒ½è¿›è¡Œäº†é•¿åº¦æ£€æŸ¥
- [ ] æä¾›äº†å¹³å°ç‰¹å®šçš„æ–‡æœ¬é•¿åº¦é™åˆ¶
- [ ] ä½¿ç”¨äº†ç»Ÿä¸€çš„æ–‡æœ¬å¤„ç†å·¥å…·å‡½æ•°
- [ ] è€ƒè™‘äº†ä¸­è‹±æ–‡æ··æ’çš„æ˜¾ç¤ºæ•ˆæœ
- [ ] æµ‹è¯•äº†æç«¯é•¿åº¦çš„æ–‡æœ¬å†…å®¹
- [ ] ç¡®ä¿æˆªæ–­ä¸ä¼šç ´åè¯­ä¹‰å®Œæ•´æ€§

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
```typescript
// ä½¿ç”¨ useMemo ç¼“å­˜æ ¼å¼åŒ–ç»“æœ
const displayTitle = useMemo(
  () => formatTitle(title, isH5 ? 16 : 20),
  [title, isH5]
)

// é¿å…åœ¨æ¸²æŸ“ä¸­è¿›è¡Œå¤æ‚æ–‡æœ¬å¤„ç†
const processedContent = useMemo(
  () => ({
    username: formatUsername(user.name),
    title: formatTitle(content.title),
    description: formatDescription(content.description)
  }),
  [user.name, content.title, content.description]
)
```

### æµ‹è¯•è¦†ç›–è¦æ±‚
```typescript
// æ–‡æœ¬å¤„ç†å‡½æ•°å¿…é¡»åŒ…å«çš„æµ‹è¯•ç”¨ä¾‹
describe('formatUsername', () => {
  it('should handle Chinese characters correctly', () => {
    expect(formatUsername('æµ‹è¯•ç”¨æˆ·å', 4)).toBe('æµ‹è¯•...')
  })
  
  it('should handle mixed Chinese and English', () => {
    expect(formatUsername('Userç”¨æˆ·', 6)).toBe('Userç”¨...')
  })
  
  it('should handle long English names', () => {
    expect(formatUsername('VeryLongUsername', 8)).toBe('VeryLo...')
  })
})
```

## âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. æ–‡æœ¬æˆªæ–­ä½ç½®ä¸å½“
**é—®é¢˜**ï¼šåœ¨å•è¯æˆ–å­—ç¬¦ä¸­é—´æˆªæ–­ï¼Œå½±å“å¯è¯»æ€§
**è§£å†³**ï¼šä½¿ç”¨æ™ºèƒ½æˆªæ–­ï¼Œä¼˜å…ˆåœ¨ç©ºæ ¼ã€æ ‡ç‚¹å¤„æˆªæ–­

### 2. ä¸­è‹±æ–‡æ··æ’æ˜¾ç¤ºä¸ä¸€è‡´
**é—®é¢˜**ï¼šä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦å®½åº¦è®¡ç®—ä¸å‡†ç¡®
**è§£å†³**ï¼šä½¿ç”¨å­—ç¬¦å®½åº¦è®¡ç®—ï¼Œä¸­æ–‡æŒ‰2å€å®½åº¦å¤„ç†

### 3. ä¸åŒå¹³å°æ˜¾ç¤ºå·®å¼‚å¤§
**é—®é¢˜**ï¼šåŒæ ·çš„æ–‡æœ¬åœ¨H5å’Œå°ç¨‹åºæ˜¾ç¤ºæ•ˆæœä¸åŒ
**è§£å†³**ï¼šå»ºç«‹å¹³å°ç‰¹å®šçš„æ˜¾ç¤ºé…ç½®å’Œæ ·å¼

### 4. æ•°å­—æ˜¾ç¤ºä¸å¤Ÿç›´è§‚
**é—®é¢˜**ï¼šå¤§æ•°å­—æ˜¾ç¤ºå ç”¨è¿‡å¤šç©ºé—´
**è§£å†³**ï¼šä½¿ç”¨kã€wç­‰å•ä½ç®€åŒ–æ˜¾ç¤º

### 5. å¸ƒå±€è¢«é•¿æ–‡æœ¬æ’‘ç ´
**é—®é¢˜**ï¼šæœªå¤„ç†çš„é•¿æ–‡æœ¬å¯¼è‡´å¸ƒå±€æ··ä¹±
**è§£å†³**ï¼šå¼ºåˆ¶ä½¿ç”¨CSSæ–‡æœ¬æº¢å‡ºå¤„ç†

---
*è¿™å¥—æ–‡æœ¬å¤„ç†è§„èŒƒç¡®ä¿äº†åŠ¨æ€å†…å®¹åœ¨å„ç§åœºæ™¯ä¸‹çš„æœ€ä½³æ˜¾ç¤ºæ•ˆæœ*